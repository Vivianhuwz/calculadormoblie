<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="Calculadora de Lucro para diferentes plataformas de vendas">
  <meta name="theme-color" content="#409EFF">
  <title>Calculadora de Lucro - Sistema de Plataformas</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#409EFF',
            success: '#67C23A',
            warning: '#E6A23C',
            danger: '#F56C6C',
            info: '#7F8C8D',
            'gray-50': '#f5f7fa',
            'gray-100': '#DCDFE6',
            'gray-200': '#C9CDD4',
            'gray-300': '#606266',
            'gray-400': '#4E5969',
            'gray-500': '#303133',
          },
          fontFamily: {
            inter: ['Inter', 'Arial', 'sans-serif'],
          },
        },
      },
      // 添加响应式断点
      screens: {
        'sm': '640px',
        'md': '768px',
        'lg': '1024px',
        'xl': '1280px',
        '2xl': '1536px',
      }
    }
  </script>
  
  <style>
    .platform-tab {
      transition: all 0.3s ease;
    }
    
    .platform-tab:hover {
      background-color: #f3f4f6;
    }
    
    .platform-tab.active {
      background-color: #EBF3FF;
      border-right: 3px solid #409EFF;
      color: #409EFF;
    }
    
    .result-card {
      transition: all 0.3s ease;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      padding: 2px 8px; /* 减小内边距 */
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .result-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #4DB3FF 0%, #409EFF 100%);
    }
    
    .btn-primary:hover {
      background: linear-gradient(135deg, #66B1FF 0%, #3A8EE6 100%);
    }
    
    .btn-success {
      background: linear-gradient(135deg, #7ED321 0%, #67C23A 100%);
    }
    
    .btn-success:hover {
      background: linear-gradient(135deg, #85CE61 0%, #5DAF34 100%);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #FF7875 0%, #F56C6C 100%);
    }
    
    .btn-danger:hover {
      background: linear-gradient(135deg, #F78989 0%, #DD6161 100%);
    }
    
    .btn-warning {
      background: linear-gradient(135deg, #FFBA5A 0%, #E6A23C 100%);
    }
    
    .btn-warning:hover {
      background: linear-gradient(135deg, #EEB964 0%, #CF9236 100%);
    }
    
    .btn-info {
      background: linear-gradient(135deg, #A8B2B9 0%, #7F8C8D 100%);
    }
    
    .btn-info:hover {
      background: linear-gradient(135deg, #95A5A6 0%, #6C7879 100%);
    }
    
    .input-field {
      font-family: Arial;
      font-size: 10pt; /* 减小字体大小 */
      padding: 4px 8px; /* 减小内边距 */
      border: 1px solid #DCDFE6; /* 减小边框宽度 */
      border-radius: 4px; /* 减小圆角 */
      transition: border-color 0.3s;
      height: 28px; /* 设置固定高度 */
      max-width: 120px; /* 设置最大宽度，使输入框更窄 */
      width: 100%; /* 保持响应式布局 */
    }
    
    .input-field:focus {
      outline: none;
      border-color: #409EFF;
      box-shadow: 0 0 0 2px rgba(64, 158, 255, 0.2);
    }
    
    .selling-price {
      font-weight: bold;
      color: #303133;
    }
    
    .result-label {
      font-family: Arial;
      font-size: 10pt; /* 减小字体大小 */
      color: #606266;
      font-weight: 500;
    }
    
    .result-value {
      font-family: Arial;
      font-size: 11pt; /* 减小字体大小 */
      color: #303133;
      font-weight: 600;
    }
    
    .suggested-price {
      font-size: 13pt; /* 减小字体大小 */
      font-weight: bold;
      color: #409EFF;
    }
    
    .history-area {
      background-color: #f5f7fa;
      border: 2px solid #DCDFE6;
      border-radius: 8px;
      padding: 15px;
      font-size: 11pt;
      min-height: 300px;
      max-height: 400px;
      overflow-y: auto;
    }
    
    /* 添加新的紧凑结果区域样式 */
    .results-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px; /* 减小间距 */
    }
    
    /* 添加移动端响应式样式 */
    @media (max-width: 768px) {
      .input-field {
        max-width: 100%;
        width: 100%;
      }
      
      main {
        flex-direction: column;
        padding: 1rem;
        gap: 1rem;
      }
      
      .flex.w-1\/2 {
        width: 100%;
      }
      
      .flex {
        flex-direction: column;
      }
      
      /* 在移动端每个输入框独占一行 */
      .flex > div.flex.items-center.w-1\/2 {
        width: 100%;
        margin-bottom: 0.5rem;
      }
      
      /* 调整标签和输入框在移动端的布局 */
      .flex.items-center {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .flex.items-center label {
        width: 100%;
        margin-bottom: 0.25rem;
      }
      
      .flex.items-center input {
        margin-left: 0;
        width: 100%;
      }
      
      #mlRateOptions {
        margin-left: 0;
        margin-top: 0.5rem;
      }
      
      /* 移动端字段位置交换 - Taxa de Nota Fiscal 和 Preço de Venda */
      /* 针对表单容器内的字段重新排序 */
      .bg-white.rounded-xl.shadow-sm.p-4.mb-6 .flex.flex-col.gap-3 {
        display: flex;
        flex-direction: column;
      }
      
      /* 交换第二行和第三行的位置 */
      /* 第二行：Preço de Custo + Taxa de Nota Fiscal */
      .bg-white.rounded-xl.shadow-sm.p-4.mb-6 .flex.flex-col.gap-3 > .flex:nth-child(2) {
        order: 3;
      }
      
      /* 第三行：Preço de Venda + Frete */
      .bg-white.rounded-xl.shadow-sm.p-4.mb-6 .flex.flex-col.gap-3 > .flex:nth-child(3) {
        order: 2;
      }
      
      /* 在交换后的行内，交换左右字段的位置 */
      /* 原第二行（现在是第三行）：交换 Preço de Custo 和 Taxa de Nota Fiscal */
      .bg-white.rounded-xl.shadow-sm.p-4.mb-6 .flex.flex-col.gap-3 > .flex:nth-child(2) {
        flex-direction: row-reverse;
      }
      
      /* 原第三行（现在是第二行）：交换 Preço de Venda 和 Frete */
      .bg-white.rounded-xl.shadow-sm.p-4.mb-6 .flex.flex-col.gap-3 > .flex:nth-child(3) {
        flex-direction: row-reverse;
      }
      
      /* 移动端主内容区域调整 */
      .flex-1.flex.flex-col {
        width: 100%;
      }
      
      main {
        padding: 1rem !important;
        flex-direction: column !important;
        gap: 1rem !important;
      }
    }
    
    /* 汉堡菜单动画 */
    .hamburger-line {
      transition: all 0.3s ease;
    }
    
    #mobileMenuBtn.active .hamburger-line:nth-child(1) {
      transform: rotate(45deg) translate(5px, 5px);
    }
    
    #mobileMenuBtn.active .hamburger-line:nth-child(2) {
      opacity: 0;
    }
    
    #mobileMenuBtn.active .hamburger-line:nth-child(3) {
      transform: rotate(-45deg) translate(7px, -6px);
    }
    
    /* 移动端侧边栏样式 */
    #mobileSidebar.show {
      transform: translateX(0);
    }
    
    /* 移动端平台选择样式 */
    .platform-tab-mobile.active {
      background-color: #eff6ff !important;
      color: #2563eb !important;
      border: 1px solid #bfdbfe !important;
    }
    
    .platform-tab-mobile.active .w-8 {
      background-color: #2563eb !important;
    }
    
    .platform-tab-mobile.active span {
      color: #2563eb !important;
      font-weight: 600 !important;
    }
    
    /* 移动端导航项悬停效果 */
    .platform-tab-mobile:hover {
      background-color: #f9fafb !important;
      transform: translateX(2px);
    }
    
    /* 移动端图标容器样式 */
    .platform-tab-mobile .w-8 {
      transition: all 0.2s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    /* 移动端侧边栏背景 */
    #mobileSidebar .relative {
      background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    }
  </style>
</head>

<body class="font-inter bg-gray-50 text-gray-500 min-h-screen flex flex-col">
  <div class="flex flex-1 min-h-0">
    <!-- 左侧导航栏 - 平台选择 (桌面版) -->
    <aside class="hidden md:flex w-64 bg-white shadow-sm min-h-screen flex-col">
      <!-- Logo区域 -->
      <div class="p-6 border-b border-gray-100">
        <div class="flex items-center space-x-3">
          <div class="w-10 h-10 rounded-lg bg-primary flex items-center justify-center text-white">
            <i class="fa fa-calculator text-xl"></i>
          </div>
          <div>
            <h1 class="text-lg font-semibold text-gray-500">Calculadora de Lucro</h1>
            <p class="text-xs text-gray-300">Sistema de Cálculo de Plataformas</p>
          </div>
        </div>
      </div>
      
      <!-- 平台选择菜单 -->
      <nav class="flex-1 p-4">
        <ul class="space-y-2">
          <!-- Mercado Livre -->
          <li>
            <a href="#" onclick="selectPlatform('mercado-livre')" id="nav-mercado-livre" class="platform-tab nav-item flex items-center px-4 py-3 text-sm font-medium rounded-lg transition-colors active">
              <i class="fa fa-shopping-cart mr-3 text-lg text-blue-500"></i>
              <span>Mercado Livre</span>
              <span class="ml-auto bg-blue-100 text-blue-600 text-xs px-2 py-1 rounded-full">ML</span>
            </a>
          </li>
          
          <!-- SHEIN -->
          <li>
            <a href="#" onclick="selectPlatform('shein')" id="nav-shein" class="platform-tab nav-item flex items-center px-4 py-3 text-sm font-medium text-gray-400 rounded-lg hover:bg-gray-50 hover:text-gray-500 transition-colors">
              <div class="w-6 h-6 bg-black text-white text-sm font-bold rounded mr-3 flex items-center justify-center">S</div>
              <span>SHEIN</span>
              <span class="ml-auto bg-purple-100 text-black-600 text-xs px-2 py-1 rounded-full">SH</span>
            </a>
          </li>
          
          <!-- TIKTOK -->
            <li>
              <a href="#" onclick="selectPlatform('tiktok')" id="nav-tiktok" class="platform-tab nav-item flex items-center px-4 py-3 text-sm font-medium text-gray-400 rounded-lg hover:bg-gray-50 hover:text-gray-500 transition-colors">
                <i class="fa-brands fa-tiktok mr-3 text-lg text-black"></i>
                <span>TIKTOK</span>
                <span class="ml-auto bg-red-100 text-red-600 text-xs px-2 py-1 rounded-full">TK</span>
              </a>
            </li>
          
          <!-- SHOPEE -->
          <li>
            <a href="#" onclick="selectPlatform('shopee')" id="nav-shopee" class="platform-tab nav-item flex items-center px-4 py-3 text-sm font-medium text-gray-400 rounded-lg hover:bg-gray-50 hover:text-gray-500 transition-colors">
              <i class="fa fa-shopping-bag mr-3 text-lg text-orange-500"></i>
              <span>SHOPEE</span>
              <span class="ml-auto bg-orange-100 text-orange-600 text-xs px-2 py-1 rounded-full">SP</span>
            </a>
          </li>
          
          <!-- Magalu -->
          <li>
            <a href="#" onclick="selectPlatform('magalu')" id="nav-magalu" class="platform-tab nav-item flex items-center px-4 py-3 text-sm font-medium text-gray-400 rounded-lg hover:bg-gray-50 hover:text-gray-500 transition-colors">
              <span class="inline-flex items-center justify-center w-6 h-6 bg-blue-600 text-white text-sm font-bold rounded mr-3">M</span>
              <span>Magalu</span>
              <span class="ml-auto bg-blue-100 text-blue-600 text-xs px-2 py-1 rounded-full">MG</span>
            </a>
          </li>
          
          <!-- Amazon -->
          <li>
            <a href="#" onclick="selectPlatform('amazon')" id="nav-amazon" class="platform-tab nav-item flex items-center px-4 py-3 text-sm font-medium text-gray-400 rounded-lg hover:bg-gray-50 hover:text-gray-500 transition-colors">
              <i class="fa-brands fa-amazon mr-3 text-lg text-yellow-600"></i>
              <span>Amazon</span>
              <span class="ml-auto bg-yellow-100 text-yellow-600 text-xs px-2 py-1 rounded-full">AM</span>
            </a>
          </li>
          
          <!-- Personalizado -->
          <li>
            <a href="#" onclick="selectPlatform('personalizado')" id="nav-personalizado" class="platform-tab nav-item flex items-center px-4 py-3 text-sm font-medium text-gray-400 rounded-lg hover:bg-gray-50 hover:text-gray-500 transition-colors">
              <i class="fa fa-cog mr-3 text-lg text-gray-500"></i>
              <span>Personalizado</span>
              <span class="ml-auto bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded-full">PS</span>
            </a>
          </li>
        </ul>
      </nav>
      
      <!-- 底部操作区域 -->
      <div class="p-4 border-t border-gray-100">
        <!-- 删除这个按钮，因为要移动到主要按钮区域 -->
      </div>
    </aside>

    <!-- 右侧主要内容区域 -->
    <div class="flex-1 flex flex-col">
      <!-- Barra de navegação superior -->
      <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="px-4 sm:px-6">
          <div class="flex items-center justify-between h-16">
            <!-- 移动端：左侧区域 -->
            <div class="md:hidden flex items-center space-x-3">
              <!-- 汉堡菜单 -->
              <button id="mobileMenuBtn" class="p-2 rounded-lg hover:bg-gray-100 transition-colors" onclick="toggleMobileMenu()">
                <div class="w-6 h-6 flex flex-col justify-center items-center">
                  <div class="hamburger-line w-5 h-0.5 bg-gray-500 mb-1 transition-all duration-300"></div>
                  <div class="hamburger-line w-5 h-0.5 bg-gray-500 mb-1 transition-all duration-300"></div>
                  <div class="hamburger-line w-5 h-0.5 bg-gray-500 transition-all duration-300"></div>
                </div>
              </button>
              
              <!-- 移动端标题 -->
              <div>
                <h1 class="text-lg font-semibold text-gray-500">Calculadora</h1>
              </div>
            </div>
            
            <!-- 桌面版标题 -->
            <div class="hidden md:block">
              <h1 class="text-xl font-semibold text-gray-500" id="platformTitle">Mercado Livre - Calculadora de Lucro</h1>
              <p class="text-sm text-gray-300" id="platformDescription">Configure os parâmetros e calcule o lucro</p>
            </div>
            
            <!-- 操作按钮区域 -->
            <div class="flex space-x-2 md:space-x-3">
              <button onclick="clearAllInputs()" class="px-3 py-2 md:px-3 md:py-2 bg-gray-100 text-gray-500 rounded-lg hover:bg-gray-200 transition-colors text-sm md:text-base">
                <i class="fa fa-refresh mr-0 md:mr-2"></i><span class="hidden md:inline">Limpar Tudo</span>
              </button>
              <button onclick="exportHistory()" class="hidden md:flex px-3 py-2 md:px-4 bg-info text-white rounded-lg hover:bg-info/90 transition-colors btn-info text-sm md:text-base">
                <i class="fa fa-download mr-1 md:mr-2"></i><span class="hidden sm:inline">Exportar</span><span class="sm:hidden">Export</span>
              </button>
            </div>
          </div>
        </div>
      </header>

      <!-- 移动端侧边栏菜单 -->
      <div id="mobileSidebar" class="md:hidden fixed inset-0 z-40 transform -translate-x-full transition-transform duration-300 ease-in-out">
        <!-- 背景遮罩 -->
        <div class="absolute inset-0 bg-black bg-opacity-50" onclick="closeMobileMenu()"></div>
        
        <!-- 侧边栏内容 -->
        <div class="relative w-80 max-w-sm bg-white h-full shadow-xl">
          <!-- Logo区域 -->
          <div class="p-6 border-b border-gray-100">
            <div class="flex items-center justify-between">
              <div class="flex items-center space-x-3">
                <div class="w-10 h-10 rounded-lg bg-primary flex items-center justify-center text-white">
                  <i class="fa fa-calculator text-xl"></i>
                </div>
                <div>
                  <h1 class="text-lg font-semibold text-gray-500">Calculadora de Lucro</h1>
                  <p class="text-xs text-gray-300">Sistema de Cálculo</p>
                </div>
              </div>
              <button onclick="closeMobileMenu()" class="p-2 rounded-lg hover:bg-gray-100 transition-colors">
                <i class="fa fa-times text-gray-400"></i>
              </button>
            </div>
          </div>
          
          <!-- 平台选择菜单 -->
          <nav class="flex-1 p-3">
            <ul class="space-y-1">
              <!-- Mercado Livre -->
              <li>
                <a href="#" onclick="selectPlatform('mercado-livre'); closeMobileMenu()" id="nav-mercado-livre-mobile" class="platform-tab-mobile nav-item flex items-center px-4 py-3 text-sm font-medium rounded-xl transition-all duration-200 active bg-blue-50 text-blue-600 border border-blue-100">
                  <div class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center mr-3">
                    <i class="fa fa-shopping-cart text-white text-sm"></i>
                  </div>
                  <span class="font-medium">Mercado Livre</span>
                </a>
              </li>
              
              <!-- SHEIN -->
              <li>
                <a href="#" onclick="selectPlatform('shein'); closeMobileMenu()" id="nav-shein-mobile" class="platform-tab-mobile nav-item flex items-center px-4 py-3 text-sm font-medium text-gray-600 rounded-xl hover:bg-gray-50 hover:text-gray-700 transition-all duration-200">
                  <div class="w-8 h-8 bg-black rounded-lg flex items-center justify-center mr-3">
                    <span class="text-white text-xs font-bold">S</span>
                  </div>
                  <span class="font-medium">SHEIN</span>
                </a>
              </li>
              
              <!-- TIKTOK -->
              <li>
                <a href="#" onclick="selectPlatform('tiktok'); closeMobileMenu()" id="nav-tiktok-mobile" class="platform-tab-mobile nav-item flex items-center px-4 py-3 text-sm font-medium text-gray-600 rounded-xl hover:bg-gray-50 hover:text-gray-700 transition-all duration-200">
                  <div class="w-8 h-8 bg-black rounded-lg flex items-center justify-center mr-3">
                    <i class="fa-brands fa-tiktok text-white text-sm"></i>
                  </div>
                  <span class="font-medium">TIKTOK</span>
                </a>
              </li>
              
              <!-- SHOPEE -->
              <li>
                <a href="#" onclick="selectPlatform('shopee'); closeMobileMenu()" id="nav-shopee-mobile" class="platform-tab-mobile nav-item flex items-center px-4 py-3 text-sm font-medium text-gray-600 rounded-xl hover:bg-gray-50 hover:text-gray-700 transition-all duration-200">
                  <div class="w-8 h-8 bg-orange-500 rounded-lg flex items-center justify-center mr-3">
                    <i class="fa fa-shopping-bag text-white text-sm"></i>
                  </div>
                  <span class="font-medium">SHOPEE</span>
                </a>
              </li>
              
              <!-- Magalu -->
              <li>
                <a href="#" onclick="selectPlatform('magalu'); closeMobileMenu()" id="nav-magalu-mobile" class="platform-tab-mobile nav-item flex items-center px-4 py-3 text-sm font-medium text-gray-600 rounded-xl hover:bg-gray-50 hover:text-gray-700 transition-all duration-200">
                  <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center mr-3">
                    <span class="text-white text-xs font-bold">M</span>
                  </div>
                  <span class="font-medium">Magalu</span>
                </a>
              </li>
              
              <!-- Amazon -->
              <li>
                <a href="#" onclick="selectPlatform('amazon'); closeMobileMenu()" id="nav-amazon-mobile" class="platform-tab-mobile nav-item flex items-center px-4 py-3 text-sm font-medium text-gray-600 rounded-xl hover:bg-gray-50 hover:text-gray-700 transition-all duration-200">
                  <div class="w-8 h-8 bg-yellow-500 rounded-lg flex items-center justify-center mr-3">
                    <i class="fa-brands fa-amazon text-white text-sm"></i>
                  </div>
                  <span class="font-medium">Amazon</span>
                </a>
              </li>
              
              <!-- Personalizado -->
              <li>
                <a href="#" onclick="selectPlatform('personalizado'); closeMobileMenu()" id="nav-personalizado-mobile" class="platform-tab-mobile nav-item flex items-center px-4 py-3 text-sm font-medium text-gray-600 rounded-xl hover:bg-gray-50 hover:text-gray-700 transition-all duration-200">
                  <div class="w-8 h-8 bg-gray-500 rounded-lg flex items-center justify-center mr-3">
                    <i class="fa fa-cog text-white text-sm"></i>
                  </div>
                  <span class="font-medium">Personalizado</span>
                </a>
              </li>
            </ul>
          </nav>
        </div>
      </div>

      <!-- Área de conteúdo principal -->
      <main class="flex-1 px-6 py-6 flex gap-6">
        <!-- Área de entrada de dados -->
        <div class="flex-1">
          
          <!-- Formulário de entrada -->
          <div class="bg-white rounded-xl shadow-sm p-4 mb-6">  <!-- 减小p-6为p-4 -->
            <h2 class="text-lg font-semibold text-gray-500 mb-3">Dados do Produto</h2>  <!-- 减小mb-4为mb-3 -->
            
            <div class="flex flex-col gap-3">  <!-- 改为单列flex布局 -->
              <!-- Modelo do Produto 和 Valor de liquidação 在同一行 -->
              <div class="flex items-center">
                <div class="flex items-center w-1/2">
                  <label class="text-sm font-medium text-gray-300 w-40">Modelo do Produto</label>
                  <input type="text" id="productModel" class="input-field py-1 ml-2" placeholder="Digite o modelo do produto" style="width: 200px;">
                </div>
                <div class="flex items-center w-1/2">
                  <label class="text-sm font-medium text-gray-300 w-40">Valor de Liquidação</label>
                  <span id="liquidationValueDisplay" class="text-lg font-semibold text-success ml-2" style="width: 120px;">R$ 0,00</span>
                </div>
              </div>
              
              <!-- 每行两个输入框 -->
              <div class="flex">
                <div class="flex items-center w-1/2">
                  <label class="text-sm font-medium text-gray-300 w-40">Preço de Custo (R$)</label>
                  <input type="text" id="costPrice" class="input-field py-1 ml-2" value="0,00" oninput="formatCurrency(this)" style="width: 120px;">
                </div>
                <div class="flex items-center w-1/2">
                  <label class="text-sm font-medium text-gray-300 w-40">Taxa de Nota Fiscal (%)</label>
                  <input type="text" id="invoiceRate" class="input-field py-1 ml-2" value="8,00" oninput="formatPercentage(this)" style="width: 120px;">
                </div>
              </div>
              
              <div class="flex">
                <div class="flex items-center w-1/2">
                  <label class="text-sm font-medium text-gray-300 w-40">Preço de Venda (R$)</label>
                  <input type="text" id="sellingPrice" class="input-field selling-price py-1 ml-2" value="0,00" oninput="formatCurrency(this)" style="width: 120px;">
                </div>
                <div class="flex items-center w-1/2">
                  <label class="text-sm font-medium text-gray-300 w-40">Frete (R$)</label>
                  <input type="text" id="shippingFee" class="input-field py-1 ml-2" value="20,00" oninput="formatCurrency(this)" style="width: 120px;">
                </div>
              </div>
              
              <div class="flex">
                <div class="flex flex-col w-1/2">
                  <div class="flex items-center">
                    <label class="text-sm font-medium text-gray-300 w-40">Taxa da Plataforma (%)</label>
                    <input type="text" id="platformFeeRate" class="input-field py-1 ml-2" value="11,50" oninput="formatPercentage(this)" style="width: 120px;">
                  </div>
                  <div id="mlRateOptions" class="flex gap-3 text-sm ml-40">
                    <label class="flex items-center">
                      <input type="radio" name="mlRate" value="11.5" checked class="mr-1"> Normal (11,5%)
                    </label>
                    <label class="flex items-center">
                      <input type="radio" name="mlRate" value="16.5" class="mr-1"> Premium (16,5%)
                    </label>
                  </div>
                </div>
                <div class="flex items-center w-1/2">
                  <label class="text-sm font-medium text-gray-300 w-40">Taxa do Item (R$)</label>
                  <input type="text" id="itemFee" class="input-field py-1 ml-2" value="0,00" oninput="formatCurrency(this)" style="width: 120px;">
                </div>
              </div>
              
              <div class="flex">
                <div class="flex items-center w-1/2">
                  <label class="text-sm font-medium text-gray-300 w-40">Taxa de Lucro Alvo (%)</label>
                  <input type="text" id="targetProfitRate" class="input-field py-1 ml-2" value="0,00" oninput="formatPercentage(this)" style="width: 120px;">
                </div>
                <div class="flex items-center w-1/2">
                  <label class="text-sm font-medium text-gray-300 w-40">Custo de Embalagem (R$)</label>
                  <input type="text" id="materialCost" class="input-field py-1 ml-2" value="0,00" oninput="formatCurrency(this)" style="width: 120px;">
                </div>
              </div>
            </div>
          </div>
          
          <!-- Botões de ação -->
          <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
            <div class="flex flex-wrap gap-3">
              <button onclick="calculateProfit()" class="px-6 py-2 text-white rounded-lg transition-colors btn-primary">
                <i class="fa fa-calculator mr-2"></i>Calcular Lucro
              </button>
              <button onclick="suggestPrice()" class="px-6 py-2 text-white rounded-lg transition-colors btn-success">
                <i class="fa fa-lightbulb-o mr-2"></i>Sugerir Preço
              </button>
              <!-- 删除了Limpar按钮 -->
              <button onclick="compareAllPlatforms()" class="px-6 py-2 text-white rounded-lg transition-colors btn-warning">
                <i class="fa fa-balance-scale mr-2"></i>Comparar
              </button>
              <button onclick="copyPrices()" class="px-6 py-2 text-white rounded-lg transition-colors btn-info">
                <i class="fa fa-copy mr-2"></i>Copiar Preços
              </button>
            </div>
            
            <!-- 结果区域 (移动到这里) -->
            <div class="mt-6">
              <h2 class="text-lg font-semibold text-gray-500 mb-2">Resultados</h2>
              
              <div class="results-container">
                <div class="result-card bg-gray-50 rounded-lg">
                  <div class="result-label">Lucro Líquido</div>
                  <div class="result-value" id="netProfitValue">R$ 0,00</div>
                </div>
                
                <div class="result-card bg-gray-50 rounded-lg">
                  <div class="result-label">Taxa de Lucro</div>
                  <div class="result-value" id="profitRateValue">0,00%</div>
                </div>
                
                <div class="result-card bg-green-50 rounded-lg">
                  <div class="result-label">Valor de Liquidação</div>
                  <div class="result-value" id="liquidationValue">R$ 0,00</div>
                </div>
                
                <div class="result-card bg-blue-50 rounded-lg">
                  <div class="result-label">Preço Sugerido</div>
                  <div class="result-value suggested-price" id="suggestedPriceValue">R$ 0,00</div>
                </div>
                
                <div class="result-card bg-gray-50 rounded-lg">
                  <div class="result-label">Lucro Esperado</div>
                  <div class="result-value" id="expectedProfitValue">R$ 0,00</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Área lateral direita - Histórico e informações -->
        <div class="w-[22rem]">
          <!-- Informações da plataforma -->
          <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
            <h3 class="text-lg font-semibold text-gray-500 mb-4">Informações da Plataforma</h3>
            <div id="platformInfo" class="text-sm text-gray-400">
              <!-- Informações específicas da plataforma serão inseridas aqui -->
            </div>
          </div>
          
          <!-- Histórico de cálculos -->
          <div class="bg-white rounded-xl shadow-sm p-6">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-lg font-semibold text-gray-500">Histórico de Cálculos</h3>
              <button onclick="clearHistory()" class="px-3 py-1 text-xs bg-red-100 text-red-600 rounded hover:bg-red-200 transition-colors">
                <i class="fa fa-trash mr-1"></i>Limpar
              </button>
            </div>
            <div id="historyArea" class="history-area">
              <p class="text-gray-400 text-center">Nenhum cálculo realizado ainda.</p>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>
  <!-- 页脚 -->
  <footer class="bg-white shadow-sm py-4 border-t border-gray-100">
    <div class="container mx-auto px-6">
      <div class="text-center text-gray-500 text-sm">
        <p>YOUBAI PRESENTES - Copyright © 2025. Todos os direitos reservados</p>
      </div>
    </div>
  </footer>

  <script>
    // Variáveis globais
    let currentPlatform = 'mercado-livre';
    let calculationHistory = [];
    
    // Configurações das plataformas
    let platformConfigs = {
      'mercado-livre': {
        name: 'Mercado Livre',
        invoiceRate: 8,
        platformFeeRate: 11.5,
        shippingFee: 20,
        itemFee: 0,
        info: 'Mercado Livre: Taxa normal 11,5% ou Premium 16,5%. Frete grátis para pedidos abaixo de R$ 79.'
      },
      'shein': {
          name: 'SHEIN',
          invoiceRate: 8,
          platformFeeRate: 16,
          shippingFee: 0,
          itemFee: 5,
          info: 'SHEIN: Taxa fixa de 16%. Taxa do item R$ 5,00. Sem frete. Peso volum.(kg)=(Comp.[cm] × Larg.[cm] × Alt.[cm]) ÷ 6000'
        },
        'tiktok': {
          name: 'TIKTOK',
          invoiceRate: 8,
          platformFeeRate: 6,
          shippingFee: 6,  // 默认运费率为 6%
          itemFee: 2,      // 默认固定费用为 R$ 2.00（售价 < R$ 79 时）
          info: 'TIKTOK: Frete 6% do valor do produto, Taxa do item R$ 2,00 para pedidos abaixo de R$ 79.'
        },
        'shopee': {
        name: 'SHOPEE',
        invoiceRate: 8,
        platformFeeRate: 20,
        shippingFee: 0,
        itemFee: 4,
        info: 'SHOPEE: Taxa de 20% (máximo R$ 100). Taxa do item R$ 4,00. Sem frete.'
      },
      'magalu': {
        name: 'Magalu',
        invoiceRate: 8,
        platformFeeRate: 18,
        shippingFee: 0,
        itemFee: 5,
        info: 'Magalu: Taxa de 18%. Taxa do item R$ 5,00. Frete R$ 17,95 para pedidos acima de R$ 79.'
      },
      'amazon': {
        name: 'Amazon',
        invoiceRate: 8,
        platformFeeRate: 12,
        shippingFee: 0,
        itemFee: 2,
        info: 'Amazon: Taxa de 12%. Taxa do item R$ 2,00 (Plano Individual).'
      },
      'personalizado': {
        name: 'Personalizado',
        invoiceRate: 8,
        platformFeeRate: 0,
        shippingFee: 0,
        itemFee: 0,
        info: 'Plataforma personalizada: Configure todos os valores manualmente.'
      }
    };

    // Função para selecionar plataforma
    function selectPlatform(platform) {
      // Remove active class from all tabs
      document.querySelectorAll('.platform-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Add active class to selected tab
      document.getElementById(`nav-${platform}`).classList.add('active');
      
      currentPlatform = platform;
      const config = platformConfigs[platform];
      
      // Update title
      document.getElementById('platformTitle').textContent = `${config.name} - Calculadora de Lucro`;
      
      // Update platform info
      document.getElementById('platformInfo').textContent = config.info;
      
      // Update form values
      document.getElementById('invoiceRate').value = formatNumber(config.invoiceRate);
      document.getElementById('platformFeeRate').value = formatNumber(config.platformFeeRate);
      
      // TIKTOK 平台运费显示特殊处理：只显示 6，不显示格式化结果
      if (platform === 'tiktok') {
        document.getElementById('shippingFee').value = '6';
      } else {
        document.getElementById('shippingFee').value = formatNumber(config.shippingFee);
      }
      
      document.getElementById('itemFee').value = formatNumber(config.itemFee);
      
      // 修改 TIKTOK 平台的运费标签
      const shippingFeeLabel = document.querySelector('label[for="shippingFee"]') || 
                              document.querySelector('label:has(+ #shippingFee)') ||
                              document.querySelector('label.text-sm.font-medium.text-gray-300.w-40:nth-of-type(4)');
      
      if (shippingFeeLabel) {
        if (platform === 'tiktok') {
          shippingFeeLabel.textContent = 'Frete (%)';
        } else {
          shippingFeeLabel.textContent = 'Frete (R$)';
        }
      }
      
      // 同步当前平台的Taxa de Nota Fiscal到所有其他平台（除了个性化平台）
      Object.keys(platformConfigs).forEach(p => {
        if (p !== 'personalizado' && p !== platform) {
          platformConfigs[p].invoiceRate = config.invoiceRate;
        }
      });
      
      // Show/hide ML rate options
      const mlOptions = document.getElementById('mlRateOptions');
      if (platform === 'mercado-livre') {
        mlOptions.style.display = 'flex';
      } else {
        mlOptions.style.display = 'none';
      }
      
      // Set readonly states based on platform
      setFieldReadonlyStates(platform);
      
      // 自动重新计算结果
      calculateProfit();
      
      // 自动重新计算建议价格
      const targetProfitRate = parseNumber(document.getElementById('targetProfitRate').value);
      if (targetProfitRate > 0) {
        suggestPrice();
      }
    }
    
    // Função para definir campos somente leitura
    function setFieldReadonlyStates(platform) {
      const fields = {
        invoiceRate: document.getElementById('invoiceRate'),
        platformFeeRate: document.getElementById('platformFeeRate'),
        shippingFee: document.getElementById('shippingFee'),
        itemFee: document.getElementById('itemFee')
      };
      
      // Reset all fields to editable
      Object.values(fields).forEach(field => {
        field.readOnly = false;
        field.style.backgroundColor = '#ffffff';
      });
      
      // Set readonly based on platform
      switch(platform) {
        case 'mercado-livre':
          fields.shippingFee.readOnly = true;
          fields.itemFee.readOnly = true;
          fields.shippingFee.style.backgroundColor = '#f5f7fa';
          fields.itemFee.style.backgroundColor = '#f5f7fa';
          break;
        case 'shein':
          fields.platformFeeRate.readOnly = true;
          fields.shippingFee.readOnly = true;
          fields.platformFeeRate.style.backgroundColor = '#f5f7fa';
          fields.shippingFee.style.backgroundColor = '#f5f7fa';
          break;
        case 'shopee':
          fields.platformFeeRate.readOnly = true;
          fields.shippingFee.readOnly = true;
          fields.itemFee.readOnly = true;
          fields.platformFeeRate.style.backgroundColor = '#f5f7fa';
          fields.shippingFee.style.backgroundColor = '#f5f7fa';
          fields.itemFee.style.backgroundColor = '#f5f7fa';
          break;
        case 'magalu':
          fields.shippingFee.readOnly = true;
          fields.itemFee.readOnly = true;
          fields.shippingFee.style.backgroundColor = '#f5f7fa';
          fields.itemFee.style.backgroundColor = '#f5f7fa';
          break;
        case 'amazon':
          fields.shippingFee.readOnly = true;
          fields.shippingFee.style.backgroundColor = '#f5f7fa';
          break;
      }
    }
    
    // Funções de formatação
    function formatCurrency(input) {
      let value = input.value.replace(/[^\d,]/g, '');
      if (value.includes(',')) {
        let parts = value.split(',');
        if (parts[1] && parts[1].length > 2) {
          parts[1] = parts[1].substring(0, 2);
        }
        value = parts.join(',');
      }
      input.value = value;
    }
    
    function formatPercentage(input) {
      formatCurrency(input);
    }
    
    function formatNumber(num) {
      return num.toFixed(2).replace('.', ',');
    }
    
    function parseNumber(str) {
      return parseFloat(str.replace(',', '.')) || 0;
    }
    
    // Função para calcular lucro
    function calculateProfit() {
      const sellingPrice = parseNumber(document.getElementById('sellingPrice').value);
      const costPrice = parseNumber(document.getElementById('costPrice').value);
      const invoiceRate = parseNumber(document.getElementById('invoiceRate').value) / 100;
      let platformFeeRate = parseNumber(document.getElementById('platformFeeRate').value) / 100;
      let shippingFee = parseNumber(document.getElementById('shippingFee').value);
      let itemFee = parseNumber(document.getElementById('itemFee').value);
      const materialCost = parseNumber(document.getElementById('materialCost').value);
      
      // 为 Mercado Livre 添加动态费用计算
      if (currentPlatform === 'mercado-livre') {
        // 获取选择的费率
        const selectedRate = document.querySelector('input[name="mlRate"]:checked');
        if (selectedRate) {
          platformFeeRate = parseFloat(selectedRate.value) / 100;
          document.getElementById('platformFeeRate').value = formatNumber(parseFloat(selectedRate.value));
        }
        
        // 动态计算运费
        shippingFee = sellingPrice < 79 ? 0 : 20;
        document.getElementById('shippingFee').value = formatNumber(shippingFee);
        
        // 动态计算商品费用
        if (sellingPrice < 79) {
          if (sellingPrice >= 12.50 && sellingPrice < 29.00) {
            itemFee = 6.25;
          } else if (sellingPrice >= 29.00 && sellingPrice < 50.00) {
            itemFee = 6.50;
          } else if (sellingPrice >= 50.00 && sellingPrice < 79.00) {
            itemFee = 6.75;
          } else {
            itemFee = 0;
          }
        } else {
          itemFee = 0;
        }
        document.getElementById('itemFee').value = formatNumber(itemFee);
      }
      
      // 计算当前平台的利润（保持原有功能）
  const invoiceFee = sellingPrice * invoiceRate;
  let platformFee = sellingPrice * platformFeeRate;
  let calculatedShippingFee = shippingFee;

  // TIKTOK 平台特殊处理
      if (currentPlatform === 'tiktok') {
        // 运费为售价的 6%
        calculatedShippingFee = sellingPrice * 0.06;
        // 不更新运费显示值，保持显示 6
        
        // 如果售价 < 79，则有固定费用 R$ 2.00
        if (sellingPrice < 79) {
          itemFee = 2.00;
          document.getElementById('itemFee').value = '2,00';
        } else {
          itemFee = 0;
          document.getElementById('itemFee').value = '0,00';
        }
      }
      
      // Amazon 平台特殊处理
      if (currentPlatform === 'amazon') {
        // 根据售价动态计算运费
        if (sellingPrice < 30) {
          calculatedShippingFee = 4.50;
        } else if (sellingPrice < 79) {
          calculatedShippingFee = 8.00;
        } else {
          calculatedShippingFee = 21.45;
        }
        
        // 更新运费显示
        document.getElementById('shippingFee').value = formatNumber(calculatedShippingFee);
      }
  
  // 应用 SHOPEE 限制
  if (currentPlatform === 'shopee') {
    platformFee = Math.min(platformFee, 100);
  }
  
  const totalCosts = costPrice + invoiceFee + platformFee + calculatedShippingFee + itemFee + materialCost;
  const netProfit = sellingPrice - totalCosts;
  const profitRate = sellingPrice > 0 ? (netProfit / sellingPrice) * 100 : 0;
  
  // 计算 Valor de liquidação (售价减去所有费用但不减去成本价和税务发票费率)
  const liquidationValue = sellingPrice - (platformFee + calculatedShippingFee + itemFee + materialCost);
  
  // 更新当前平台结果
  document.getElementById('netProfitValue').textContent = `R$ ${formatNumber(netProfit)}`;
  document.getElementById('profitRateValue').textContent = `${formatNumber(profitRate)}%`;
  document.getElementById('liquidationValue').textContent = `R$ ${formatNumber(liquidationValue)}`;
  document.getElementById('liquidationValueDisplay').textContent = `R$ ${formatNumber(liquidationValue)}`;
  
  // 添加到历史记录
  addToHistory({
    platform: platformConfigs[currentPlatform].name,
    model: document.getElementById('productModel').value || 'Sem modelo',
    sellingPrice,
    netProfit,
    profitRate,
    timestamp: new Date().toLocaleString('pt-BR')
  });
  
  // 移除这一行，这样点击calcular lucro按钮时就不会显示平台对比表格了
  // calculateAllPlatformsProfits(sellingPrice, costPrice, materialCost);
    }
    
    // 新增函数：计算所有平台的利润
    function calculateAllPlatformsProfits(sellingPrice, costPrice, materialCost) {
      if (!sellingPrice || sellingPrice <= 0) {
        return; // 如果没有销售价格，不显示比较
      }
      
      // 获取当前选择的 Mercado Livre 费率
      const selectedMLRate = document.querySelector('input[name="mlRate"]:checked');
      const mlPlatformFeeRate = selectedMLRate ? parseFloat(selectedMLRate.value) / 100 : 0.115;
      
      // 定义所有平台的配置
      const allPlatforms = {
        'mercado-livre': {
          name: 'Mercado Livre',
          platformFeeRate: mlPlatformFeeRate, // 使用用户选择的费率
          invoiceRate: platformConfigs['mercado-livre'].invoiceRate / 100, // 使用配置中的值
          calculateFees: (price) => {
            let shipping = price < 79 ? 0 : 20;
            let itemFee = 0;
            if (price < 79) {
              if (price >= 12.50 && price < 29.00) itemFee = 6.25;
              else if (price >= 29.00 && price < 50.00) itemFee = 6.50;
              else if (price >= 50.00 && price < 79.00) itemFee = 6.75;
            }
            return { shipping, itemFee };
          }
        },
        'shein': {
          name: 'SHEIN',
          platformFeeRate: 0.16, // 16%
          invoiceRate: platformConfigs['shein'].invoiceRate / 100, // 使用配置中的值
          calculateFees: () => ({ shipping: 0, itemFee: 5 })
        },
        'tiktok': {
          name: 'TIKTOK',
          platformFeeRate: 0.06, // 6%
          invoiceRate: platformConfigs['tiktok'].invoiceRate / 100, // 使用配置中的值
          calculateFees: (price) => {
            // TIKTOK: 运费为商品价格的6%，商品费用为R$2.00（价格<R$79时）
            const shipping = price * 0.06;
            const itemFee = price < 79 ? 2.00 : 0;
            return { shipping, itemFee };
          }
        },
        'shopee': {
          name: 'SHOPEE',
          platformFeeRate: 0.20, // 20%
          invoiceRate: platformConfigs['shopee'].invoiceRate / 100, // 使用配置中的值
          calculateFees: () => ({ shipping: 0, itemFee: 4 })
        },
        'magalu': {
          name: 'Magalu',
          platformFeeRate: 0.18, // 18%
          invoiceRate: platformConfigs['magalu'].invoiceRate / 100, // 使用配置中的值
          calculateFees: (price) => ({ 
            shipping: price < 79 ? 0 : 17.95, 
            itemFee: 5 
          })
        },
        'amazon': {
          name: 'Amazon',
          platformFeeRate: 0.12, // 12%
          invoiceRate: platformConfigs['amazon'].invoiceRate / 100, // 使用配置中的值
          calculateFees: (price) => {
            // Amazon: 根据售价设置不同的运费
            let shipping;
            if (price < 30) {
              shipping = 4.50;
            } else if (price < 79) {
              shipping = 8.00;
            } else {
              shipping = 21.45;
            }
            return { shipping, itemFee: 2 };
          }
        }
      };
      
      // 计算每个平台的利润
      const results = [];
      
      Object.entries(allPlatforms).forEach(([key, config]) => {
        const fees = config.calculateFees(sellingPrice);
        const invoiceFee = sellingPrice * config.invoiceRate;
        let platformFee = sellingPrice * config.platformFeeRate;
        
        // 应用 SHOPEE 限制
        if (key === 'shopee') {
          platformFee = Math.min(platformFee, 100);
        }
        
        const totalCosts = costPrice + invoiceFee + platformFee + fees.shipping + fees.itemFee + materialCost;
        const netProfit = sellingPrice - totalCosts;
        const profitRate = sellingPrice > 0 ? (netProfit / sellingPrice) * 100 : 0;
        
        // 计算 Valor de liquidação (售价减去所有费用但不减去成本价和税务发票费率)
        const liquidationValue = sellingPrice - (platformFee + fees.shipping + fees.itemFee + materialCost);
        
        results.push({
          platform: config.name,
          netProfit,
          profitRate,
          liquidationValue,
          isCurrentPlatform: key === currentPlatform
        });
      });
      
      // 显示比较表格
      showPlatformComparison(results);
    }
    
    // 显示平台比较表格
    function showPlatformComparison(results) {
      // 创建模态框
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      `;
      
      const modalContent = document.createElement('div');
      modalContent.style.cssText = `
        background: white;
        border-radius: 8px;
        padding: 20px;
        max-width: 90%;
        max-height: 90%;
        overflow: auto;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      `;
      
      // 创建标题
      const title = document.createElement('h2');
      title.textContent = 'Comparação de Lucros - Todas as Plataformas';
      title.style.cssText = `
        margin: 0 0 20px 0;
        color: #303133;
        text-align: center;
        font-family: Arial, sans-serif;
      `;
      
      // 创建表格
      const table = document.createElement('table');
      table.style.cssText = `
        width: 100%;
        border-collapse: collapse;
        background-color: white;
        border: 1px solid #DCDFE6;
        border-radius: 4px;
        overflow: hidden;
      `;
      
      // 创建表头
      const thead = document.createElement('thead');
      const headerRow = document.createElement('tr');
      const headers = ['Plataforma', 'Lucro Líquido', 'Taxa de Lucro', 'Valor de Liquidação'];
      
      headers.forEach(headerText => {
        const th = document.createElement('th');
        th.textContent = headerText;
        th.style.cssText = `
          background-color: #F5F7FA;
          color: #303133;
          font-weight: bold;
          padding: 12px 8px;
          text-align: center;
          border-bottom: 1px solid #DCDFE6;
          font-size: 11pt;
          font-family: Arial, sans-serif;
        `;
        headerRow.appendChild(th);
      });
      
      thead.appendChild(headerRow);
      table.appendChild(thead);
      
      // 创建表体
      const tbody = document.createElement('tbody');
      
      // 自定义平台顺序，TIKTOK排在SHEIN后面
      const customOrder = ['Mercado Livre', 'SHEIN', 'TIKTOK', 'Magalu', 'SHOPEE', 'Amazon'];
      results.sort((a, b) => customOrder.indexOf(a.platform) - customOrder.indexOf(b.platform));
      
      results.forEach(result => {
        const row = document.createElement('tr');
        
        // 如果是当前平台，高亮显示
        if (result.isCurrentPlatform) {
          row.style.backgroundColor = '#E6F7FF';
        }
        
        const cells = [
          result.platform + (result.isCurrentPlatform ? ' (Atual)' : ''),
          `R$ ${formatNumber(result.netProfit)}`,
          `${formatNumber(result.profitRate)}%`,
          `R$ ${formatNumber(result.liquidationValue)}`
        ];
        
        cells.forEach((cellText, index) => {
          const td = document.createElement('td');
          td.textContent = cellText;
          td.style.cssText = `
            padding: 12px 8px;
            text-align: center;
            border-bottom: 1px solid #EBEEF5;
            color: #303133;
            font-family: Arial, sans-serif;
            ${index === 0 && result.isCurrentPlatform ? 'font-weight: bold;' : ''}
          `;
          
          // 为利润值添加颜色
          if (index === 1) {
            td.style.color = result.netProfit >= 0 ? '#67C23A' : '#F56C6C';
            td.style.fontWeight = 'bold';
          }
          
          // 为清算价值添加颜色
          if (index === 3) {
            td.style.color = result.liquidationValue >= 0 ? '#67C23A' : '#F56C6C';
            td.style.fontWeight = 'bold';
          }
          
          row.appendChild(td);
        });
        
        tbody.appendChild(row);
      });
      
      table.appendChild(tbody);
      
      // 创建关闭按钮
      const closeButton = document.createElement('button');
      closeButton.textContent = 'Fechar';
      closeButton.style.cssText = `
        margin-top: 20px;
        padding: 10px 20px;
        background: #409EFF;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        display: block;
        margin-left: auto;
        margin-right: auto;
      `;
      
      closeButton.addEventListener('click', () => {
        document.body.removeChild(modal);
      });
      
      // 组装模态框
      modalContent.appendChild(title);
      modalContent.appendChild(table);
      modalContent.appendChild(closeButton);
      modal.appendChild(modalContent);
      
      // 点击背景关闭
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          document.body.removeChild(modal);
        }
      });
      
      // 添加到页面
      document.body.appendChild(modal);
    }
    
    function suggestPrice() {
      const costPrice = parseNumber(document.getElementById('costPrice').value);
      const targetProfitRate = parseNumber(document.getElementById('targetProfitRate').value) / 100;
      const invoiceRate = parseNumber(document.getElementById('invoiceRate').value) / 100;
      const platformFeeRate = parseNumber(document.getElementById('platformFeeRate').value) / 100;
      const shippingFee = parseNumber(document.getElementById('shippingFee').value);
      const itemFee = parseNumber(document.getElementById('itemFee').value);
      const materialCost = parseNumber(document.getElementById('materialCost').value);
      
      if (targetProfitRate <= 0) {
        alert('Por favor, defina uma taxa de lucro alvo maior que 0%.');
        return;
      }
      
      // Cálculo do preço sugerido
      const fixedCosts = costPrice + shippingFee + itemFee + materialCost;
      const suggestedPrice = fixedCosts / (1 - targetProfitRate - invoiceRate - platformFeeRate);
      
      document.getElementById('suggestedPriceValue').textContent = `R$ ${formatNumber(suggestedPrice)}`;
      // document.getElementById('sellingPrice').value = formatNumber(suggestedPrice); // 注释掉这行，不再自动填充售价
      
      // Calcular lucro esperado
      const expectedProfit = suggestedPrice * targetProfitRate;
      document.getElementById('expectedProfitValue').textContent = `R$ ${formatNumber(expectedProfit)}`;
    }
    
    // Função para adicionar ao histórico
    function addToHistory(calculation) {
      // 检查是否存在重复的计算结果
      const isDuplicate = calculationHistory.some(existing => 
        existing.platform === calculation.platform &&
        existing.model === calculation.model &&
        existing.sellingPrice === calculation.sellingPrice &&
        existing.netProfit === calculation.netProfit &&
        existing.profitRate === calculation.profitRate
      );
      
      // 如果不是重复的，才添加到历史记录
      if (!isDuplicate) {
        calculationHistory.unshift(calculation);
        if (calculationHistory.length > 10) {
          calculationHistory.pop();
        }
        updateHistoryDisplay();
      }
    }
    
    // Função para atualizar exibição do histórico
    function updateHistoryDisplay() {
      const historyArea = document.getElementById('historyArea');
      
      if (calculationHistory.length === 0) {
        historyArea.innerHTML = '<p class="text-gray-400 text-center">Nenhum cálculo realizado ainda.</p>';
        return;
      }
      
      const historyHtml = calculationHistory.map(calc => `
        <div class="border-b border-gray-100 pb-3 mb-3 last:border-b-0">
          <div class="flex justify-between items-start mb-1">
            <span class="font-medium text-gray-500">${calc.platform}</span>
            <span class="text-xs text-gray-300">${calc.timestamp}</span>
          </div>
          <div class="text-sm text-gray-400">
            <div>Modelo: ${calc.model}</div>
            <div>Preço: R$ ${formatNumber(calc.sellingPrice)}</div>
            <div class="flex justify-between">
              <span>Lucro: R$ ${formatNumber(calc.netProfit)}</span>
              <span>${formatNumber(calc.profitRate)}%</span>
            </div>
          </div>
        </div>
      `).join('');
      
      historyArea.innerHTML = historyHtml;
    }
    
    // Outras funções
    function clearInputs() {
      document.getElementById('productModel').value = '';
      document.getElementById('costPrice').value = '0,00';
      document.getElementById('sellingPrice').value = '0,00';
      document.getElementById('materialCost').value = '0,00';
      document.getElementById('targetProfitRate').value = '0,00';
      
      // Reset results
      document.getElementById('netProfitValue').textContent = 'R$ 0,00';
      document.getElementById('profitRateValue').textContent = '0,00%';
      document.getElementById('suggestedPriceValue').textContent = 'R$ 0,00';
      document.getElementById('expectedProfitValue').textContent = 'R$ 0,00';
    }
    
    function clearAllInputs() {
      clearInputs();
      selectPlatform(currentPlatform); // Reset platform defaults
    }
    
    function clearHistory() {
      calculationHistory = [];
      updateHistoryDisplay();
    }
    
    function copyPrices() {
      const productModel = document.getElementById('productModel').value;
      const costPrice = document.getElementById('costPrice').value;
      const sellingPrice = document.getElementById('sellingPrice').value;
      const invoiceRate = document.getElementById('invoiceRate').value;
      const materialCost = document.getElementById('materialCost').value;
      const targetProfitRate = document.getElementById('targetProfitRate').value;
      
      // 同步所有平台的Taxa de Nota Fiscal（包括personalizado）
      const invoiceRateValue = parseNumber(invoiceRate);
      Object.keys(platformConfigs).forEach(platform => {
        platformConfigs[platform].invoiceRate = invoiceRateValue;
      });
      
      const copyText = `Modelo: ${productModel}\nPreço de Custo: R$ ${costPrice}\nPreço de Venda: R$ ${sellingPrice}\nTaxa de Nota Fiscal: ${invoiceRate}%\nCusto de Embalagem: R$ ${materialCost}\nTaxa de Lucro Alvo: ${targetProfitRate}%`;
      
      navigator.clipboard.writeText(copyText).then(() => {
        alert('Dados do produto copiados para a área de transferência!\nTaxa de Nota Fiscal sincronizada em todas as plataformas (incluindo personalizado)!');
      });
    }
    
    function compareAllPlatforms() {
      // 获取当前输入的数据
      const sellingPrice = parseNumber(document.getElementById('sellingPrice').value);
      const costPrice = parseNumber(document.getElementById('costPrice').value);
      const materialCost = parseNumber(document.getElementById('materialCost').value);
      
      // 显示平台比较表格
      calculateAllPlatformsProfits(sellingPrice, costPrice, materialCost);
    }
    
    function exportHistory() {
      if (calculationHistory.length === 0) {
        alert('Nenhum histórico para exportar.');
        return;
      }
      
      const csvContent = 'data:text/csv;charset=utf-8,' + 
        'Plataforma,Modelo,Preço de Venda,Lucro Líquido,Taxa de Lucro,Data\n' +
        calculationHistory.map(calc => 
          `${calc.platform},${calc.model},${calc.sellingPrice},${calc.netProfit},${calc.profitRate}%,${calc.timestamp}`
        ).join('\n');
      
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement('a');
      link.setAttribute('href', encodedUri);
      link.setAttribute('download', 'historico_calculos.csv');
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
    
    // Event listeners para ML rate options
    document.addEventListener('DOMContentLoaded', function() {
      const mlRateInputs = document.querySelectorAll('input[name="mlRate"]');
      mlRateInputs.forEach(input => {
        input.addEventListener('change', function() {
          if (this.checked && currentPlatform === 'mercado-livre') {
            document.getElementById('platformFeeRate').value = formatNumber(parseFloat(this.value));
            // 如果有销售价格，重新计算
            const sellingPrice = document.getElementById('sellingPrice').value;
            if (sellingPrice && parseNumber(sellingPrice) > 0) {
              calculateProfit();
            }
          }
        });
      });
      
      // 添加taxa de nota fiscal同步监听器
      document.getElementById('invoiceRate').addEventListener('blur', function() {
        const invoiceRateValue = parseNumber(this.value);
        Object.keys(platformConfigs).forEach(platform => {
          if (platform !== 'personalizado') {
            platformConfigs[platform].invoiceRate = invoiceRateValue;
          }
        });
      });
      
      // Initialize with default platform
      selectPlatform('mercado-livre');
    });
    
    // 移动端菜单控制功能
    function toggleMobileMenu() {
      const sidebar = document.getElementById('mobileSidebar');
      const menuBtn = document.getElementById('mobileMenuBtn');
      
      if (sidebar.classList.contains('show')) {
        closeMobileMenu();
      } else {
        sidebar.classList.add('show');
        menuBtn.classList.add('active');
        document.body.style.overflow = 'hidden';
      }
    }
    
    function closeMobileMenu() {
      const sidebar = document.getElementById('mobileSidebar');
      const menuBtn = document.getElementById('mobileMenuBtn');
      
      sidebar.classList.remove('show');
      menuBtn.classList.remove('active');
      document.body.style.overflow = '';
    }
    
    // 窗口大小改变时自动关闭移动端菜单
    function handleResize() {
      if (window.innerWidth >= 768) { // md breakpoint
        closeMobileMenu();
      }
    }
    
    // 监听窗口大小变化
    window.addEventListener('resize', handleResize);
    
    // 更新平台选择函数以同步桌面版和移动版的激活状态
    const originalSelectPlatform = selectPlatform;
    selectPlatform = function(platform) {
      // 调用原始函数
      originalSelectPlatform(platform);
      
      // 同步桌面版和移动版的激活状态
      document.querySelectorAll('.platform-tab').forEach(tab => {
        tab.classList.remove('active');
        tab.classList.add('text-gray-400');
      });
      
      document.querySelectorAll('.platform-tab-mobile').forEach(tab => {
        tab.classList.remove('active');
        tab.classList.add('text-gray-400');
      });
      
      // 激活选中的平台
      const desktopTab = document.getElementById(`nav-${platform}`);
      const mobileTab = document.getElementById(`nav-${platform}-mobile`);
      
      if (desktopTab) {
        desktopTab.classList.add('active');
        desktopTab.classList.remove('text-gray-400');
      }
      
      if (mobileTab) {
        mobileTab.classList.add('active');
        mobileTab.classList.remove('text-gray-400');
      }
    };
  </script>
</body>
</html>
